---
title: RIP
date: 2020-4-7
tags: 网络
author: 映雪
---

聚散匆匆，云边孤雁，水上浮萍

<!--more-->

### RIP（路由信息协议）

- RIP （Routing Information Protocol）路由信息协议是一种较为简单的**内部网关协议** IGP（Interior Gateway Protocol），主要用于规模较小的网络中，比如校园网以及结构较简单的地区性网络。对于更为复杂的环境和大型网络，一般不使用 RIP。
- RIP 是一种基于**距离矢量**（Distance-Vector）算法的协议，通过 UDP 报文进行路由信息的交换，使用的端口号为 520。它使用**跳数**（Hop Count）作为度量来衡量到达目的网络的距离。设备到与他直连网络的设备跳数为 0，然后每经过一个三层设备跳数增加 1，也就是度量值等于从本网络到达目网络间的三层设备数量，但并不等于所经过的网段数。

### RIP 版本

1. RIP V1

- 有类别路由协议（Classful Routing Protocol），它只支持以广播方式发布协议报文。RIP-1 的协议报文中没有携带掩码信息，它只能识别 A、B、C 类这样的自然网段的路由，因此 RIP-1 无法支持路由聚合，也不支持不连续子网（Discontiguous Subnet）。

2. RIP V2

- 无分类路由协议（Classless Routing Protocol），支持外部路由标记（Route Tag），可以在路由策略中根据 Tag 对路由进行灵活的控制。报文中携带掩码信息，支持路由聚合和 CIDR（Classless Inter-Domain Routing）。支持指定下一跳，在广播网上可以选择到最优下一跳地址。支持使用组播方式发送更新报文，只有 RIP-2 路由器才能收到协议报文，减少资源消耗。支持对协议报文进行验证，并提供明文验证和 MD5 验证两种方式，增强安全性。

3. RIPng

- 适用于 IPv6

### RIP 工作原理

1. 路由建立

- 路由器运行 RIP 后，会首先发送路由更新请求，收到请求的路由器会发送自己的 RIP 路由进行响应；网络稳定后，路由器会周期性发送路由更新信息。

2. 距离矢量的计算

- RIP 度量的单位是跳数，其单位是 1，也就是规定每一条链路的成本为 1，而不考虑链路的实际带宽、时延等因素，RIP 最多允许 15 跳。
  RIP 利用度量来表示它和所有已知目的地间的距离。当一个 RIP 更新报文到达时，接收方路由器和自己的 RIP 路由表中的每一项进行比较，并按照距离矢量路由算法对自己的 RIP 路由表进行修正。

3. 定时器

- 周期更新定时器：用来激发 RIP 路由器路由表的更新，每个 RIP 节点只有一个更新定时器，设为 30s。每隔 30s 路由器会向其邻居广播自己的路由表信息。每个 RIP 路由器的定时器都独立于网络中其他路由器，因此它们同时广播的可能性很小。
- 超时定时器：用来判定某条路由是否可用。每条路由有一个超时定时器，设为 180s。当一条路由激活或更新时，该定时器初始化，如果在 180s 之内没有收到关于那条路由的更新，则将该路由置为无效。
- 清除定时器：用来判定是否清除一条路由。每条路由有一个清除定时器，设为 120s。当路由器认识到某条路由无效时，就初始化一个清除定时器，如果在 120s 内还没收到这条路由的更新，就从路由表中将该路由删除。
- 延迟定时器：为避免触发更新引起广播风暴而设置的一个随机的延迟定时器，延迟时间为 1 ～ 5s。

4. 环路

- 当网络发生故障时，RIP 网络有可能产生路由环路。可以通过水平分割、毒性反转、触发更新、抑制时间等技术来避免环路的产生。

### RIP 更新机制

1. 定期更新

- 定期更新是根据设置的更新计时器定期发送 RIP 路由通告。

2. 触发更新。

- 触发更新是 RIP 路由器一旦察觉到网络变化，就尽快甚至是立即发送更新报文，而不等待更新周期结束。

- **RIP 路由的更新规则**

1. 如果更新的某路由表项在路由表中没有，则直接在路由表中添加该路由表项
2. 如果路由表中已有相同目的网络的路由表项，且来源端口相同，那么无条件根据最新的路由信息更新其路由表
3. 如果路由表中已有相同目的网络的路由表项，但来源端口不同，则要比较它们的度量值，将度量值较小的一个作为自己的路由表项
4. 如果路由表中已有相同目的网络的路由表项，且度量值相等，保留原来的路由表项

### RIP 优缺点

- 优点

1. 实现简单
2. 开销较小

- 缺点

1. 由于 15 跳为最大值，RIP 只能应用于小规模网络。
2. 收敛速度慢。
3. 根据跳数选择的路由，不一定是最优路由。


### RIP 配置

![截屏2022-06-28 上午9.48.06.png](/images/2022/06/28/CFTcvAYS7HNJRWs.png)

1. AR1 配置

```
<Huawei>sys
[Huawei]un in en  //关闭提示信息
[Huawei]int g0/0/0
[Huawei-GigabitEthernet0/0/0]ip add 192.168.1.254 24
[Huawei-GigabitEthernet0/0/0]int g0/0/1
[Huawei-GigabitEthernet0/0/1]ip add 192.168.2.1 24
[Huawei-GigabitEthernet0/0/1]q
[Huawei]rip //启用RIP协议
[Huawei-rip-1]network 192.168.1.0 //宣告网络192.168.1.0进入RIP协议
[Huawei-rip-1]network 192.168.2.0 //宣告网络192.168.2.0进入RIP协议
[Huawei-rip-1]q

```

2. AR2 配置

```
<Huawei>sys
[Huawei]un in en //关闭提示信息
[Huawei]int g0/0/0 
[Huawei-GigabitEthernet0/0/0]ip add 192.168.2.2 24
[Huawei-GigabitEthernet0/0/0]int g0/0/1
[Huawei-GigabitEthernet0/0/1]ip add 192.168.3.254 24
[Huawei-GigabitEthernet0/0/1]q
[Huawei]rip  //启用RIP协议
[Huawei-rip-1]network 192.168.2.0  //宣告网络192.168.2.0进入RIP协议
[Huawei-rip-1]network 192.168.3.0  //宣告网络192.168.3.0进入RIP协议

```

3. PC主机IP配置