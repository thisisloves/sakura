---
title: DNS
date: 2019-4-6
tags: 网络
author: 映雪
---

日长篱落无人过，惟有蜻蜓蛱蝶飞。

<!--more-->

### DNS (域名系统)

- 域名系统（Domain Name System，缩写：DNS）是互联网的一项服务。它作为将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网。DNS使用TCP和UDP端口53。当前，对于每一级域名长度的限制是63个字符，域名总长度则不能超过253个字符。DNS协议是用来将域名转换为IP地址（也可以将IP地址转换为相应的域名地址）。

![截屏2022-06-20 下午3.43.32.png](/images/2022/06/20/PqwAIH16BmbkXZx.png)

### 域名

- 域名是一个具有层次的结构，从上到下一次为根域名、顶级域名、二级域名、三级域名…

![截屏2022-06-20 下午3.55.57.png](/images/2022/06/20/vEJlRuCDQixZeGq.png)

- 例如`www.xxx.com`，www为三级域名、xxx为二级域名、com为顶级域名，系统为用户做了兼容，域名末尾的根域名.一般不需要输入，在域名的每一层都会有一个域名服务器，以及电脑默认的本地域名服务器。

![截屏2022-06-20 下午3.56.08.png](/images/2022/06/20/PBpyUmMbfizEDWq.png)

### DNS 查询方式

1. 递归查询：如果 A 请求 B，那么 B 作为请求的接收者一定要给 A 想要的答案

![截屏2022-06-20 下午4.08.23.png](/images/2022/06/20/Nyx3qr9kbpBPnFM.png)

2. 迭代查询：如果接收者 B 没有请求者 A 所需要的准确内容，接收者 B 将告诉请求者 A，如何去获得这个内容，但是自己并不去发出请求

![截屏2022-06-20 下午4.08.32.png](/images/2022/06/20/HRbS8KvyEJZtzX3.png)

### DNS 域名缓存

1. 浏览器缓存：浏览器在获取网站域名的实际 IP 地址后会对其进行缓存，减少网络请求的损耗
2. 操作系统缓存：操作系统的缓存其实是用户自己配置的 hosts 文件


### DNS 查询过程

![截屏2022-06-20 下午4.15.09.png](/images/2022/06/20/Wgos8hMRq3N2xHE.png)

1. 首先搜索浏览器的 DNS 缓存，缓存中维护一张域名与 IP 地址的对应表
2. 若没有命中，则继续搜索操作系统的 DNS 缓存
3. 若仍然没有命中，则操作系统将域名发送至本地域名服务器，本地域名服务器采用递归查询自己的 DNS 缓存，查找成功则返回结果
4. 若本地域名服务器的 DNS 缓存没有命中，则本地域名服务器向上级域名服务器进行迭代查询
- 首先本地域名服务器向根域名服务器发起请求，根域名服务器返回顶级域名服务器的地址给本地服务器
- 本地域名服务器拿到这个顶级域名服务器的地址后，就向其发起请求，获取权限域名服务器的地址
- 本地域名服务器根据权限域名服务器的地址向其发起请求，最终得到该域名对应的 IP 地址
5. 本地域名服务器将得到的 IP 地址返回给操作系统，同时自己将 IP 地址缓存起来
6. 操作系统将 IP 地址返回给浏览器，同时自己也将 IP 地址缓存起
